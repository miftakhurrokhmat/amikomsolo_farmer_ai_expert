<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SMART Tani AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      body {
        font-family: 'Poppins', sans-serif;
        background-color: #f9fafb;
        color: #374151;
      }
      header {
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }
      .logo {
        font-weight: 700;
        font-size: 1.5rem;
        color: #111827;
        text-decoration: none;
      }
      .identification {
        background: #fff;
        border-radius: 0.75rem;
        padding: 2rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
      .scan-btn {
        background-color: #2563eb;
        border: none;
        transition: 0.3s;
      }
      .scan-btn:hover {
        background-color: #1e40af;
        transform: scale(1.05);
      }
      .result {
        margin-top: 1.5rem;
      }
      .card {
        border-radius: 0.75rem;
      }
      .card-title {
        font-size: 1.1rem;
        font-weight: 600;
      }
      .badge {
        font-size: 0.85rem;
      }
      
      .logo-img {
        height: 60px; /* atur sesuai kebutuhan (misal 60‚Äì80px) */
        width: auto; /* biar proporsi gambar terjaga */
      }
      
      .logo-text {
        font-weight: 700;
        font-size: 1.75rem; /* lebih besar dari sebelumnya */
        color: #111827;
      }
    </style>
  </head>
  <body>
    <header>
      <nav class="navbar navbar-light bg-white shadow-sm">
        <div class="container">
          <a href="/" class="navbar-brand d-flex align-items-center">
            <span class="fw-bold text-success">SMART Tani | AI Expert System</span>
          </a>
        </div>
      </nav>
    </header>

    <main class="container my-5">
      <div class="row g-5">
        <div class="col-12 col-lg-6 hero-text">
          <h1>Identifikasi Penyakit Tanaman dengan AI</h1>
          <p>Unggah foto tanaman untuk mendapatkan analisis cepat beserta rekomendasi penanganan.</p>
        </div>
        <div class="col-12 col-lg-6">
          <div class="identification">
            <h2 class="mb-4 text-center">Identifikasi Sekarang</h2>
            <form id="identify-form" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="image-input" class="form-label">Upload Gambar Tanaman</label>
                <input type="file" class="form-control" id="image-input" name="image" accept="image/*" />
              </div>
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="topk-check" />
                <label class="form-check-label" for="topk-check">Tampilkan 3 kemungkinan teratas</label>
              </div>
              <div class="d-grid">
                <button type="button" class="btn btn-primary scan-btn" id="scan-btn">üîç Scan & Identifikasi</button>
              </div>
            </form>
            <div id="result" class="result" hidden></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      const scanBtn = document.getElementById('scan-btn')
      const resultDiv = document.getElementById('result')
      const imageInput = document.getElementById('image-input')
      const topkCheck = document.getElementById('topk-check')
      
      scanBtn.addEventListener('click', async () => {
        if (!imageInput.files.length) {
          alert('Mohon upload gambar terlebih dahulu.')
          return
        }
        resultDiv.hidden = true
        resultDiv.innerHTML = ''
        scanBtn.disabled = true
        scanBtn.textContent = '‚è≥ Memindai...'
      
        const formData = new FormData()
        formData.append('image', imageInput.files[0])
        const top_k = topkCheck.checked ? 3 : 1
        const url = `/api/predict?top_k=${top_k}`
      
        try {
          const res = await fetch(url, { method: 'POST', body: formData })
          const data = await res.json()
          scanBtn.disabled = false
          scanBtn.textContent = 'üîç Scan & Identifikasi'
      
          if (data.status === 'success') {
            if (top_k === 1) {
              const d = data.result.details
              resultDiv.innerHTML = `
                                                    <div class="card shadow-sm border-0 mt-3">
                                                      <div class="card-body">
                                                        <h5 class="card-title">
                                                          ${d.nama_penyakit}
                                                          <span class="badge bg-primary ms-2">${(data.result.confidence * 100).toFixed(1)}%</span>
                                                        </h5>
                                                        ${d.alias && d.alias.length ? `<p class="mb-1"><strong>üåç Nama Lain:</strong> ${d.alias.join(', ')}</p>` : ''}
                                                        <p class="mb-1"><strong>ü©∫ Gejala:</strong> ${d.gejala || '-'}</p>
                                                        <p class="mb-0"><strong>üí° Rekomendasi:</strong> ${d.rekomendasi}</p>
                                                      </div>
                                                    </div>
                                                  `
            } else {
              let html = '<h5 class="mt-3">3 Kemungkinan Teratas:</h5><div class="row mt-2">'
              data.result.top_predictions.forEach((p, i) => {
                html += `
                                                      <div class="col-12 mb-3">
                                                        <div class="card shadow-sm border-0 h-100">
                                                          <div class="card-body">
                                                            <h5 class="card-title">
                                                              ${i + 1}. ${p.details.nama_penyakit}
                                                              <span class="badge bg-primary ms-2">${(p.confidence * 100).toFixed(1)}%</span>
                                                            </h5>
                                                            ${p.details.alias && p.details.alias.length ? `<p class="mb-1"><strong>üåç Nama Lain:</strong> ${p.details.alias.join(', ')}</p>` : ''}
                                                            <p class="mb-1"><strong>ü©∫ Gejala:</strong> ${p.details.gejala || '-'}</p>
                                                            <p class="mb-0"><strong>üí° Rekomendasi:</strong> ${p.details.rekomendasi}</p>
                                                          </div>
                                                        </div>
                                                      </div>
                                                    `
              })
              html += '</div>'
              resultDiv.innerHTML = html
            }
          } else {
            resultDiv.innerHTML = `<p class="text-danger">‚ùå Error: ${data.message || 'Terjadi kesalahan'}</p>`
          }
          resultDiv.hidden = false
        } catch (err) {
          console.error(err)
          alert('Gagal menghubungi server.')
        }
      })
    </script>
  </body>
</html>
